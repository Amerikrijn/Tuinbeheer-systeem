import '@testing-library/jest-dom'
import { vi } from 'vitest'

// Mock Next.js router
vi.mock('next/navigation', () => ({
  useRouter: () => ({
    push: vi.fn(),
    replace: vi.fn(),
    prefetch: vi.fn(),
    back: vi.fn(),
    forward: vi.fn(),
    refresh: vi.fn(),
  }),
  useSearchParams: () => new URLSearchParams(),
  usePathname: () => '/',
}))

// Mock Next.js server components
vi.mock('next/server', () => ({
  NextRequest: vi.fn().mockImplementation((url, options) => ({
    url,
    method: options?.method || 'GET',
    headers: new Map(Object.entries(options?.headers || {})),
    json: vi.fn().mockResolvedValue({}),
    ...options,
  })),
  NextResponse: {
    json: vi.fn().mockImplementation((data, options) => ({
      json: vi.fn().mockResolvedValue(data),
      status: options?.status || 200,
    })),
  },
}))

// Mock Supabase
vi.mock('@/lib/supabase', () => ({
  supabase: {
    from: vi.fn(() => ({
      select: vi.fn().mockReturnThis(),
      insert: vi.fn().mockReturnThis(),
      update: vi.fn().mockReturnThis(),
      delete: vi.fn().mockReturnThis(),
      eq: vi.fn().mockReturnThis(),
      single: vi.fn(),
    })),
  },
}))

// Mock environment variables
process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co'
process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY = 'test-key'

// Global test utilities
global.testUtils = {
  mockGarden: {
    id: '1',
    name: 'Test Garden',
    description: 'A test garden',
    location: 'Test Location',
    is_active: true,
    created_at: '2024-01-01T00:00:00Z',
    updated_at: '2024-01-01T00:00:00Z',
  },
  mockPlantBed: {
    id: '1',
    garden_id: '1',
    name: 'Test Plant Bed',
    location: 'North Side',
    size: '2x3m',
    soil_type: 'clay',
    sun_exposure: 'full-sun',
    description: 'A test plant bed',
    is_active: true,
    created_at: '2024-01-01T00:00:00Z',
    updated_at: '2024-01-01T00:00:00Z',
  },
  mockPlant: {
    id: '1',
    plant_bed_id: '1',
    name: 'Test Rose',
    scientific_name: 'Rosa rubiginosa',
    variety: 'Red',
    color: '#FF0000',
    height: 50,
    status: 'healthy',
    created_at: '2024-01-01T00:00:00Z',
    updated_at: '2024-01-01T00:00:00Z',
  },
}

// Suppress console warnings in tests
const originalConsoleError = console.error
console.error = (...args) => {
  if (typeof args[0] === 'string' && args[0].includes('Warning:')) {
    return
  }
  originalConsoleError.call(console, ...args)
}